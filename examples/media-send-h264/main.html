<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>libdatachannel media example</title>
  </head>
  <body>
    <p>Please enter the offer provided to you by the application:</p>
    <textarea cols="50" rows="50"></textarea>
    <button>Submit</button>

    <video width="640" height="360" id="remoteVideo" autoplay playsinline muted></video>

    <script>
      document.querySelector('button').addEventListener('click', async () => {
        let offer = JSON.parse(document.querySelector('textarea').value);
        let rtc = new RTCPeerConnection({
          // Recommended for libdatachannel
          bundlePolicy: 'max-bundle',
        });

        rtc.onicegatheringstatechange = (state) => {
          if (rtc.iceGatheringState === 'complete') {
            // We only want to provide an answer once all of our candidates have been added to the SDP.
            let answer = rtc.localDescription;
            document.querySelector('textarea').value = JSON.stringify({
              type: answer.type,
              sdp: answer.sdp,
            });
            document.querySelector('p').value = 'Please paste the answer in the application.';
            alert('Please paste the answer in the application.');
          }
        };

        rtc.ontrack = (event) => {
          console.log(event);
          const elem = /** @type {HTMLVideoElement} */ (document.getElementById("remoteVideo"))
          elem.srcObject = event.streams[0];
          elem.play().catch(console.error);
        }

        await rtc.setRemoteDescription(offer);
        let answer = await rtc.createAnswer();
        await rtc.setLocalDescription(answer);
      });
    </script>
  </body>
</html>
